{"version":3,"sources":["../src/html_ctrl.js"],"names":["MetricsPanelCtrl","_","kbn","TimeSeries","rendering","ace","getLocationSrv","GrafanaJSCompleter","$lang_tools","$control","$panel","editor","session","pos","prefix","callback","getCursorPosition","line","getLine","row","substring","column","match","length","lastIndexOf","panelthis","evalObj","eval","evaluatePrefix","ctrl","htmlnode","document","querySelector","wordList","map","word","caption","value","meta","key","push","Array","isArray","HTMLCtrl","$scope","$injector","$rootScope","panelDefaults","links","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","aliasColors","format","css_data","html_data","js_code","js_init_code","defaults","panel","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","initialized","editors","addEditorTab","unitFormats","getUnitFormats","aceLangTools","acequire","addCompleter","nodeId","setTimeout","$","edit","attr","setValue","getSession","val","getValue","resetHTML","render","err","console","error","setOptions","enableBasicAutocompletion","enableLiveAutocompletion","theme","showPrintMargin","setInitFunction","setHandleMetricFunction","mode","subItem","data","series","color","alias","handleMetric","Function","doInit","isFunction","dataList","type","tableHandler","table","docsHandler","seriesHandler","seriesData","datapoints","target","flotpairs","getFlotPairs","tableData","columnNames","columns","text","rows","datapoint","forEach","columnIndex","aliasName","i","getSeriesIdByAlias","isNumber","decimals","scaledDecimals","delta","dec","Math","floor","log","LN10","magn","pow","norm","size","result","max","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","formatter","scope","elem","attrs","valuemap","query","varname","startsWith","update","partial","replace","scrollable","templateUrl"],"mappings":"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","file":"html_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport TimeSeries from 'app/core/time_series';\nimport rendering from './rendering';\nimport ace from './node_modules/brace/index.js';\nimport './node_modules/brace/ext/language_tools.js';\nimport './node_modules/brace/theme/tomorrow_night_bright.js';\nimport './node_modules/brace/mode/javascript.js';\nimport { getLocationSrv } from '@grafana/runtime';\n//import './node_modules/brace/mode/plain_text.js';\n\nclass GrafanaJSCompleter {\n    constructor($lang_tools, $control, $panel) {\n        this.$lang_tools = $lang_tools;\n        this.$control = $control;\n        this.$panel = $panel;\n    }\n\n    getCompletions(editor, session, pos, prefix, callback) {\n        var pos = editor.getCursorPosition();\n        var line = editor.session.getLine(pos.row);\n\n        prefix = line.substring(0, pos.column).match(/this\\.\\S*/g);\n        if (prefix) {\n            prefix = prefix[prefix.length - 1];\n            prefix = prefix.substring(0, prefix.lastIndexOf('.'));\n\n            var panelthis = this.$panel;\n            var evalObj = eval('panel' + prefix);\n            this.evaluatePrefix(evalObj, callback);\n            return;\n        }\n\n        prefix = line.substring(0, pos.column).match(/ctrl\\.\\S*/g);\n        if (prefix) {\n            prefix = prefix[prefix.length - 1];\n            prefix = prefix.substring(0, prefix.lastIndexOf('.'));\n\n            var ctrl = this.$control;\n            var evalObj = eval(prefix);\n            this.evaluatePrefix(evalObj, callback);\n            return;\n        }\n\n        prefix = line.substring(0, pos.column).match(/htmlnode\\.\\S*/g);\n        if (prefix) {\n            prefix = prefix[prefix.length - 1];\n            prefix = prefix.substring(0, prefix.lastIndexOf('.'));\n\n            var htmlnode = document.querySelector('.html-object');\n            var evalObj = eval(prefix);\n            this.evaluatePrefix(evalObj, callback);\n            return;\n        }\n\n        if (prefix == '') {\n            var wordList = ['ctrl', 'htmlnode', 'this'];\n\n            callback(null, wordList.map(function (word) {\n                return {\n                    caption: word,\n                    value: word,\n                    meta: 'Grafana keyword'\n                };\n            }));\n        }\n    }\n\n    evaluatePrefix(evalObj, callback) {\n        var wordList = [];\n        for (var key in evalObj) {\n            wordList.push(key);\n        }\n        callback(null, wordList.map(function (word) {\n            return {\n                caption: word + ': ' + (Array.isArray(evalObj[word]) ? 'Array[' + (evalObj[word] || []).length + ']' : typeof evalObj[word]),\n                value: word,\n                meta: \"Grafana keyword\"\n            };\n        }));\n        return;\n    }\n}\n\n\nexport class HTMLCtrl extends MetricsPanelCtrl {\n  static scrollable = true;\n    constructor($scope, $injector, $rootScope) {\n        super($scope, $injector);\n        this.$rootScope = $rootScope;\n        var panelDefaults = {\n            links: [],\n            datasource: null,\n            maxDataPoints: 3,\n            interval: null,\n            targets: [{}],\n            cacheTimeout: null,\n            nullPointMode: 'connected',\n            aliasColors: {},\n            format: 'short',\n\n            css_data: '',\n            html_data: '',\n            js_code: '',\n            js_init_code: '',\n        };\n\n        _.defaults(this.panel, panelDefaults);\n\n        this.events.on('render', this.onRender.bind(this));\n        this.events.on('refresh', this.onRender.bind(this));\n        this.events.on('data-received', this.onDataReceived.bind(this));\n        this.events.on('data-error', this.onDataError.bind(this));\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\n        this.initialized = 0;\n        this.editors = {};\n    }\n\n    onInitEditMode() {\n        this.addEditorTab('HTML', 'public/plugins/aidanmountford-html-panel/partials/editor_html.html', 2);\n        this.addEditorTab('Events', 'public/plugins/aidanmountford-html-panel/partials/editor_events.html', 3);\n        this.unitFormats = kbn.getUnitFormats();\n        this.aceLangTools = ace.acequire(\"ace/ext/language_tools\");\n        this.aceLangTools.addCompleter(new GrafanaJSCompleter(this.aceLangTools, this, this.panel));\n    }\n\n    doShowAceHtml(nodeId) {\n        setTimeout(function () {\n            if ($('#' + nodeId).length === 1) {\n                this.editors[nodeId] = ace.edit(nodeId);\n                $('#' + nodeId).attr('id', nodeId + '_initialized');\n                this.editors[nodeId].setValue(this.panel[nodeId], 1);\n                this.editors[nodeId].getSession().on('change', function () {\n                    var val = this.editors[nodeId].getSession().getValue();\n                    this.panel[nodeId] = val;\n                    try {\n                        this.resetHTML();\n                        this.render();\n                    } catch (err) {\n                        console.error(err);\n                    }\n                }.bind(this));\n                this.editors[nodeId].setOptions({\n                    enableBasicAutocompletion: true,\n                    enableLiveAutocompletion: true,\n                    theme: 'ace/theme/tomorrow_night_bright',\n                    showPrintMargin: false\n                });\n            }\n        }.bind(this), 100);\n        return true;\n    }\n    doShowAceCSS(nodeId) {\n        setTimeout(function () {\n            if ($('#' + nodeId).length === 1) {\n                this.editors[nodeId] = ace.edit(nodeId);\n                $('#' + nodeId).attr('id', nodeId + '_initialized');\n                this.editors[nodeId].setValue(this.panel[nodeId], 1);\n                this.editors[nodeId].getSession().on('change', function () {\n                    var val = this.editors[nodeId].getSession().getValue();\n                    this.panel[nodeId] = val;\n                    try {\n                        this.resetHTML();\n                        this.render();\n                    } catch (err) {\n                        console.error(err);\n                    }\n                }.bind(this));\n                this.editors[nodeId].setOptions({\n                    enableBasicAutocompletion: true,\n                    enableLiveAutocompletion: true,\n                    theme: 'ace/theme/tomorrow_night_bright',\n                    showPrintMargin: false\n                });\n            }\n        }.bind(this), 100);\n        return true;\n    }\n    doShowAceJs(nodeId) {\n        setTimeout(function () {\n            if ($('#' + nodeId).length === 1) {\n                this.editors[nodeId] = ace.edit(nodeId);\n                $('#' + nodeId).attr('id', nodeId + '_initialized');\n                this.editors[nodeId].setValue(this.panel[nodeId], 1);\n                this.editors[nodeId].getSession().on('change', function () {\n                    var val = this.editors[nodeId].getSession().getValue();\n                    this.panel[nodeId] = val;\n                    try {\n                        this.setInitFunction();\n                        this.setHandleMetricFunction();\n                        this.render();\n                    } catch (err) {\n                        console.error(err);\n                    }\n                }.bind(this));\n                this.editors[nodeId].setOptions({\n                    enableBasicAutocompletion: true,\n                    enableLiveAutocompletion: true,\n                    theme: 'ace/theme/tomorrow_night_bright',\n                    mode: 'ace/mode/javascript',\n                    showPrintMargin: false\n                });\n            }\n        }.bind(this), 100);\n        return true;\n    }\n\n    setUnitFormat(subItem) {\n        this.panel.format = subItem.value;\n        this.render();\n    }\n\n    onDataError() {\n        this.data = [];\n        this.render();\n    }\n\n    changeSeriesColor(series, color) {\n        series.color = color;\n        this.panel.aliasColors[series.alias] = series.color;\n        this.render();\n    }\n\n    setHandleMetricFunction() {\n        this.panel.handleMetric = Function('ctrl', 'htmlnode', this.panel.js_code);\n    }\n\n    setInitFunction() {\n        this.initialized = 0;\n        this.panel.doInit = Function('ctrl', 'htmlnode', this.panel.js_init_code);\n    }\n\n    onRender() {\n        if (!_.isFunction(this.panel.handleMetric)) {\n            this.setHandleMetricFunction();\n        }\n\n        if (!_.isFunction(this.panel.doInit)) {\n            this.setInitFunction();\n        }\n    }\n\n    onDataReceived(dataList) {\n        this.data = [];\n\n        if (dataList.length > 0 && dataList[0].type === 'table') {\n            this.data = dataList.map(this.tableHandler.bind(this));\n            this.table = this.data; // table should be regarded as deprecated\n        } else if (dataList.length > 0 && dataList[0].type === 'docs') {\n            this.data = dataList.map(this.docsHandler.bind(this));\n        } else {\n            this.data = dataList.map(this.seriesHandler.bind(this));\n            this.series = this.data; // series should be regarded as deprectated\n        }\n\n        this.render();\n    }\n\n    resetHTML() {\n        this.initialized = 0;\n    }\n\n    seriesHandler(seriesData) {\n        const series = new TimeSeries({\n            datapoints: seriesData.datapoints,\n            alias: seriesData.target\n        });\n\n        series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n        return series;\n    }\n\n\n    docsHandler(seriesData) {\n        return seriesData;\n    }\n\n    tableHandler(tableData) {\n\n        const columnNames = tableData.columns.map(column => column.text);\n\n        const rows = tableData.rows.map(row => {\n            const datapoint = {};\n\n            row.forEach((value, columnIndex) => {\n                const key = columnNames[columnIndex];\n                datapoint[key] = value;\n            });\n\n            return datapoint;\n        });\n\n        return {columnNames: columnNames, rows: rows};\n    }\n\n    getSeriesIdByAlias(aliasName) {\n        for (var i = 0; i < this.data.length; i++) {\n            if (this.data[i].alias == aliasName) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    getSeriesElementByAlias(aliasName) {\n        var i = this.getSeriesIdByAlias(aliasName);\n        if (i >= 0) {\n            return this.data[i];\n        }\n        return null;\n    }\n\n    getDecimalsForValue(value) {\n        if (_.isNumber(this.panel.decimals)) {\n            return {decimals: this.panel.decimals, scaledDecimals: null};\n        }\n\n        var delta = value / 2;\n        var dec = -Math.floor(Math.log(delta) / Math.LN10);\n\n        var magn = Math.pow(10, -dec);\n        var norm = delta / magn; // norm is between 1.0 and 10.0\n        var size;\n\n        if (norm < 1.5) {\n            size = 1;\n        } else if (norm < 3) {\n            size = 2;\n            // special case for 2.5, requires an extra decimal\n            if (norm > 2.25) {\n                size = 2.5;\n                ++dec;\n            }\n        } else if (norm < 7.5) {\n            size = 5;\n        } else {\n            size = 10;\n        }\n\n        size *= magn;\n\n        // reduce starting decimals if not needed\n        if (Math.floor(value) === value) {\n            dec = 0;\n        }\n\n        var result = {};\n        result.decimals = Math.max(0, dec);\n        result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\n\n        return result;\n    }\n\n    formatValue(value) {\n        var decimalInfo = this.getDecimalsForValue(value);\n        var formatFunc = kbn.valueFormats[this.panel.format];\n        if (formatFunc) {\n            return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n        }\n        return value;\n    }\n\n    formatValueWithFormatter(value, formatter) {\n        var decimalInfo = this.getDecimalsForValue(value);\n        var formatFunc = kbn.valueFormats[formatter];\n        if (formatFunc) {\n            return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n        }\n        return value;\n    }\n\n    link(scope, elem, attrs, ctrl) {\n        rendering(scope, elem, attrs, ctrl);\n    }\n\n    setVariables(valuemap) {\n      var query = {};\n      for (var key in valuemap) {\n        //console.log('update variable in URL', key, valuemap[key] );\n        var varname = key;\n        if (!key.startsWith('var-') && key !== 'from' && key !== 'to') {\n          varname = 'var-' + key;\n        }\n        query[varname] = valuemap[key];\n      }\n      getLocationSrv().update({\n        partial: true,\n        query: query,\n        replace: true\n      });\n    }\n}\n\nHTMLCtrl.templateUrl = 'module.html';\n"]}